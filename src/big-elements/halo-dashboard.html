<!-- <link rel="import" href="../../bower_components/polymer/polymer-element.html"> -->
<link rel="import" href="../../bower_components/polymer/lib/legacy/class.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../../special-components/paper-time-picker/paper-time-picker.html">
<link rel="import" href="../../special-components/paper-dialog/paper-dialog.html">


<link rel="import" href="mini-elements/main-menu.html">
<link rel="import" href="mini-elements/micro-elements/trips.html">
<link rel="import" href="mini-elements/micro-elements/users.html">
<link rel="import" href="mini-elements/micro-elements/accounting.html">
<link rel="import" href="mini-elements/micro-elements/ticket-tabel.html">
<link rel="import" href="mini-elements/micro-elements/ticket.html">
<!-- <link rel="import" href="mini-elements/micro-elements/user-acc.html"> -->
<link rel="import" href="mini-elements/micro-elements/error-element.html">
<link rel="import" href="mini-elements/micro-elements/archived-trips.html">
<link rel="import" href="mini-elements/micro-elements/acc-archived-trips.html">
<link rel="import" href="mini-elements/micro-elements/external-acc.html">

<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/granite-bootstrap/granite-bootstrap.html">
<link rel="stylesheet" href="../../styles.css">

<dom-module id="halo-dashboard">
    <template>
        <style include="app-grid-style">
            *{
              font-family: GESS-Light;
            }
            .changeFont{
              font-family: sans-serif !important;
            }
            app-toolbar{
                color: white;
                box-shadow: 0px 1px 5px #000000;
                z-index: 10;
                min-height: 100px;
                padding: 0;
            }
            paper-listbox{
                --paper-listbox-color:gray;
            }
            paper-listbox .iron-selected iron-icon{
                color: #EABD00;
            }
            paper-listbox .iron-selected a{
                color: white;
                background-color: #016064 !important;
            }
            paper-listbox .iron-selected{
              color: white;
              background-color: #016064 !important;
              font-weight: lighter;
            }
            paper-listbox a{
              text-decoration: none;
              color: #016064;
              cursor: default;
              font-weight: lighter;
              width: 100%;
              padding: 15px;
            }
            paper-item:not(:first-child){
                  box-shadow: 0 2px 2px -2px gray;
            }
            paper-item{
              padding: 0;
            }
            paper-progress {
                display: block;
                width: 100%;
            }
            app-drawer-layout{
              background-color: #f0f0f0;
            }
            .content{
                padding: 20px;
                margin-right: 200px;
                margin-bottom: 35px;
                background-color: #f0f0f0;
                min-height: 70vh;
            }
            .afterContent{
              position: fixed;
              left: 0;
              right: 100px;
              bottom: 0;
              width: 100%;
              border-top: 1px solid black;
              text-align: center;
              box-shadow: 0 -5px 5px -5px #333;
              background-color: var(--app-primary-color);
            }
            .afterContent a{
              text-decoration: none;
              color: white;
            }
            .afterContent a:hover{
              color: black;
            }
            .afterContent p{
              width: 100%;
              margin-top: 5px;
              margin-bottom: 0;
            }
            app-drawer {
                box-shadow: -1px 0px 10px #888888;
                z-index: 5;
                top: 100px;
                transition-duration: 10ms !important;
                height: 100%;
                --app-drawer-content-container: {
                    padding-top: 30px;
                };
            }
            .logoHeader{
                background-size: contain;
              background-image: url("../../images/png/logo pages-01.png");
              /*background-size: cover;*/
              height: 100%;
              width: 100%;
              background-repeat: no-repeat;
              background-position: right 10px top;
            }
            :host {
                  --app-drawer-width:  200px;
                  --app-grid-columns: 3;
                  --app-primary-color: #016064;

              }
            .item {
                padding: 25px;
                max-width: 33.3%;
            }

            #drawerSmall{
                width: 60px;
            }
            .belowToolbar{
                height: 10px;
                color: white;
                font-weight: lighter;
            }
            app-header{
              background-color: var(--app-primary-color);
            }
            .drawerIronIcon{
              margin-left: 10px;
            }
            .showSmallDrawer{
              float: left;
            }
            .showDrwer{
              width: 60px;
              height: 50px;
            }
            #menuList{
              margin-top: 50px;
            }
            .signOutBtn{
              margin-top: 15px;
              background-color: #B82C2C;
              width: 90%;
              color: white;
              font-size: 20px;
            }
            .signOutIcon{
              margin-top: 15px;
              color: #B82C2C;
              width: 60px;
              height: 50px;
            }
            .pagebreak {
                page-break-before: always;
            }
            .pagebreak:first-child{
                page-break-before: avoid;
            }
            @media print {
                body{
                    margin: 0;
                    margin-top: 0 !important;

                }
                app-header, app-drawer{
                    visibility: hidden;
                }
                .content{
                    padding:0;
                    background-color: white;
                    margin-right: 0;
                }
                app-drawer-layout{
                    background-color: white;
                }
                .afterContent{
                  right: auto;
                }
            }
            #toastWarning {
                text-align: center;
                --paper-toast-background-color: red;
                --paper-toast-color: white;
            }

        </style>
            <!-- app-location binds to the app's URL -->
            <app-location route="{{route}}" use-hash-as-path="true"></app-location>

            <!-- this app-route manages the top-level routes -->
            <app-route
                    route="{{route}}"
                    pattern="/:view"
                    data="{{routeData}}"
                    tail="{{subroute}}"></app-route>

            <app-header-layout>

            <app-header id="header" fixed condenses slot="header">
                <app-toolbar>
                        <div class="logoHeader"></div>
                    <!--<paper-progress value="10" indeterminate bottom-item></paper-progress>-->
                </app-toolbar>
                <div class="belowToolbar"></div>
              </app-header>

              <app-drawer-layout>
                <app-drawer id="drawer" opened persistent align="right" position="right">
                  <paper-icon-button class="showDrwer showSmallDrawer" icon="close" onclick="HaloDashboard.drawerToggle()"></paper-icon-button>
                    <paper-listbox id="menuList" selected="0" >
                        <template is="dom-repeat" items="{{drawermenu}}">
                            <paper-item>
                              <a href="{{item.link}}" tabindex="-1">
                                <iron-icon class="drawerIronIcon" icon="{{item.icon}}" item-icon></iron-icon>
                                {{item.text}}
                              </a>
                            </paper-item>
                        </template>
                    </paper-listbox>
                    <paper-button class="signOutBtn" onclick="HaloDashboard.signOut()" raised>خروج</paper-button>
                </app-drawer>

                <app-drawer id="drawerSmall" persistent align="right" position="right">
                  <paper-icon-button class="showDrwer showBigerDrawer" icon="menu" onclick="HaloDashboard.drawerToggle();"></paper-icon-button>
                    <paper-listbox id="menuListMobile" selected="0" >
                        <template is="dom-repeat" items="{{drawermenu}}">
                          <paper-item>
                            <a href="{{item.link}}" tabindex="-1">
                              <iron-icon class="drawerSmallIronIcon" icon="{{item.icon}}" item-icon></iron-icon>
                            </a>
                          </paper-item>
                        </template>
                    </paper-listbox>
                    <paper-icon-button icon="exit-to-app" onclick="HaloDashboard.signOut()" class="signOutIcon">خروج</paper-icon-button>
                </app-drawer>
                <div class="mainContent">
                  <div class="content">
                      <!-- iron-pages selects the view based on the active route -->
                      <iron-pages role="main" selected="[[routeData.view]]" attr-for-selected="name" fallback-selection="404">
                          <main-menu name="" id="mainmenu"></main-menu>
                          <users-element name="users" id="users"></users-element>
                          <accounting-element name="accounting" id="accounting"></accounting-element>
                          <trips-element name="trips" id="trips" ></trips-element>
                          <archived-trips name="archived-trips" ></archived-trips>
                          <ticket-tabel name="ticket-tabel" id="ticket-tabel"></ticket-tabel>
                          <ticket-element name="ticket" id="ticket"></ticket-element>
                          <acc-archived-trips name="acc-archived-trips"></acc-archived-trips>
                          <external-acc-element name="external-acc"></external-acc-element>
                          <!-- <user-acc name="user-accounting"></user-acc> -->
                          <error-element name="404"></error-element>
                      </iron-pages>
                  </div>
                  <div class="afterContent">
                    <p>
                      <a href="http://www.lampa-eg.com" target="_blank">Powered by Lampa <span class="changeFont">2017</span> &copy;</a>
                    </p>
                  </div>
                </div>
            </app-drawer-layout>

        </app-header-layout>


        <paper-toast id="toastWarning" class="fit-bottom" duration="0" text="خطأ, يرجى التأكد من الاتصال بالانترنت "></paper-toast>
    </template>

    <script>

        /**
         * @customElement
         * @polymer
         */
        var toastWarning;
        var secondCall = true;
        var drawer= "";
        var drawerSmall= "";
        var elements= "";
        var appHeader = "";
        var routesWithIds = {
            "":0,
            "users":1,
            "trips":2,
            "accounting":3,
            "external-acc":4
        };
        var accounting, users;

        mobilecheck = function() {
            var check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            return check;
        };
        class HaloDashboard extends Polymer.Element {
            static get is() { return 'halo-dashboard'; }
            static get properties() {
                return {
                    drawermenu: {
                        type: Array,
                        value: []
                    },routeData:{
                            type:String,
                        observer:"routeChanged"
                    },
                };
            }
            static signOut(){
              signOutUser();
              window.reload();
            }

            static drawerToggle(){
                drawer.toggle();
                drawerSmall.toggle();
                var ismobile = mobilecheck;
                if (ismobile){
                    if (drawer.opened){
                        for(var i=0; i<elements.length; i++){
                          elements[i].children[i].style.marginRight =  "200px";
                          elements[i].children[i+1].style.right =  "100px";
                        }
                    }else {
                        for(var i=0; i<elements.length; i++){
                          elements[i].children[i].style.marginRight =  "60px";
                          elements[i].children[i+1].style.right =  "30px";
                        }
                    }
                }else {
                }


            }
            static checkConn(logMsg) {
                var online = navigator.onLine;
                if(!online){
                    toastWarning.close();
                    if (logMsg === false) {
                        toastWarning.open();
                    } else if(logMsg === true){
                        toastWarning.close();
                    }
                } else {
                    toastWarning.close();
                    secondCall = false;
                }

            };
            ready() {
                super.ready();
                drawer = this.$.drawer;
                drawerSmall = this.$.drawerSmall;
                elements = this.shadowRoot.querySelectorAll('.mainContent');
                appHeader =this.$.header;
                users = this.$.users;
                accounting = this.$.accounting;

                var mainMenu = this.$.mainmenu;

                toastWarning = this.$.toastWarning;
                users.style.display = "none";
                accounting.style.display = "none";
                this.drawermenu =[
                    {
                        icon:'dashboard',
                        text:'لوحة التحكم',
                        link: '/#/'
                    },
                    {
                        icon:'editor:insert-drive-file',
                        text:'الرحلات',
                        link: '#/trips'
                    },
                ];
                mainMenu.cards = [{
                    url:'./images/png/4-01.png',
                    title:'الرحلات',
                    link:'#/trips'
                }];

                var boundFunction = (function(assignUserType){
                    if(assignUserType == true){

                        users.style.display = "block";
                        accounting.style.display = "block";
                        mainMenu.cards = [{
                            url:'./images/png/4-01.png',
                            title:'الرحلات',
                            link:'#/trips'
                        },
                            {
                                url:'./images/png/3-01.png',
                                title:'المستخدمون',
                                link:'#/users'
                            },
                            {
                                url:'./images/png/2-01.png',
                                title:'الحسابات',
                                link: '#/accounting'
                            },
                            {
                                url:'./images/png/2-01.png',
                                title: 'الحسابات الخارجية',
                                link: '/#/external-acc'
                            }
                        ];
                        this.drawermenu=[
                            {
                                icon:'dashboard',
                                text:'لوحة التحكم',
                                link: '/#/'
                            },
                            {
                                icon:'social:person',
                                text:'المستخدمون',
                                link: '#/users'
                            },
                            {
                                icon:'editor:insert-drive-file',
                                text:'الرحلات',
                                link: '#/trips'
                            },
                            {
                                icon:'editor:attach-money',
                                text:'الحسابات',
                                link: '#/accounting'
                            },
                            {
                                icon:'editor:monetization-on',
                                text: 'الحسابات الخارجية',
                                link: '/#/external-acc'
                            }
                        ];
                    }else {

                        users.style.display = "none";
                        accounting.style.display = "none";
                        this.drawermenu =[
                            {
                                icon:'dashboard',
                                text:'لوحة التحكم',
                                link: '/#/'
                            },
                            {
                                icon:'editor:insert-drive-file',
                                text:'الرحلات',
                                link: '#/trips'
                            },
                        ];
                        mainMenu.cards = [{
                            url:'./images/png/4-01.png',
                            title:'الرحلات',
                            link:'#/trips'
                        }];
                    }
                }).bind(this);
                checkUserType(boundFunction);
// Add event listener offline to detect network loss.
                window.addEventListener("offline", function(e) {
                    HaloDashboard.checkConn(false);
                });

// Add event listener online to detect network recovery.
                window.addEventListener("online", function(e) {
                    HaloDashboard.checkConn(true);
                });
                var ismobile = mobilecheck;
                if (ismobile()){
                    HaloDashboard.drawerToggle();
                    HaloDashboard.drawerToggle = function () {
                        drawer.toggle();
                        drawerSmall.toggle();

                        if (drawer.opened){
                            for(var i=0; i<elements.length; i++){
                                elements[i].style.display =  "none";
                            }

                        }else {
                            for(var i=0; i<elements.length; i++){
                                elements[i].style.display =  "block";
                            }
                        }

                    };
                }
                ////for checking connection and view toast////
//                checkConn(function (logMsg) {
//                    var online = navigator.onLine;
//                    if(!online){
//                        toastWarning.close();
//                        if (logMsg === false) {
//                            toastWarning.open();
//                        } else if(logMsg === true){
//                            toastWarning.close();
//                        }
//                    } else {
//                        secondCall = false;
//                    }
//
//                });
            }
            routeChanged(){
                this.$.menuList.selected = routesWithIds[this.routeData.view];
                this.$.menuListMobile.selected = routesWithIds[this.routeData.view];
            }
        }

        window.customElements.define(HaloDashboard.is, HaloDashboard);
    </script>
</dom-module>
